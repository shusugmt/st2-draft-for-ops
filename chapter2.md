## DMM.com ラボが目指す運用基盤
　本編前半で解説した StackStorm の特徴を踏まえ、DMM.com ラボのインフラ運用において StackStorm がどのようなケースで、どのような効果を発揮している（あるいは発揮することを期待している）かについて紹介します。  

### Case1: 社内向けサービス運用
　社内向けのサービスの例として、社内のドキュメント・タスク管理システムを想像してみてください。ここでは、システムとシステムのアカウント・権限を管理する人、そしてこのシステムを利用する全社員という構図が成り立ちます。  

(挿絵) 社内システム / 管理者 / 利用ユーザの図

　システムの管理者は、サービスを管理する部内向けにアカウント/権限の追加・変更・削除のワークフロー (定型化された依頼をユーザどのように申請し、申請された依頼に対してどのようにオペレーションを行い、報告するかを規定した一連の作業マニュアル) を整備するとともに、サービスを利用するユーザ向けに利用マニュアルを作成すると思います。  
　ユーザがサービスのワークフローを知っている場合には、ユーザはそれに沿って申請を行い、システム管理者もスムーズに依頼された作業をこなすことができます。  
　しかしユーザへの周知が不足していた場合、ユーザはどのように依頼すべきなのかわかりません。そのため、ユーザはシステム管理者に対して、直接メールやチャット、あるいは直接デスクに訪問するといった非定型的な手段で申請することになります。結果、システム管理者側の運用コストが増大すると共に、生産性が低下する可能性があります。また、依頼したオペレーションが円滑に処理が行われないことで、システムを利用するユーザの生産性が低下する可能性もあります。  
　こうしたケースが一つだけでしたら、ワークフローの周知を徹底するといった運用でカバーすることもできるかもしれません。ですが、このほかに存在する全ての社内システム（コミュニケーションシステム、ソースコード管理システム、構成管理システム、勤怠管理システム、etc...）において、それぞれの管理者がワークフローの周知を全てのユーザに対して徹底することは現実的に難しいです。  

(挿絵) 複数の社内システムがバラバラに運用されている図

　また利用ユーザが増加した場合、管理者が処理する依頼数も増えることで、更にシステムの管理・運用コストが増大します。  
　DMM.com ラボのインフラでは、サービス環境を維持するためにさまざまなシステム (仮想基盤、ストレージ、ネットワーク、LB、DNS、NTP、etc) の管理・運用を行います。そして、社内のサービス開発者（ユーザ）からの要求に応じてサービス運用者（管理者）がこれらのシステム群へのオペレーションを行いますが、サービスが大規模・複雑化することでサービス運用者が忙殺されていく様子を目にします。  

(挿絵) 利用ユーザが増えた場合に管理者が忙殺される図

　これに対して StackStorm は、定型化されたオペレーションの API をユーザに対して提供する運用プラットフォームとしての役割を果たすことで上記の問題を解決できると見込んでいます。  

(挿絵) StackStorm による運用の図

　システム管理者は定型化されたオペレーションを StackStorm のモジュールとしてコード化 (あるいは、[過去に StackStorm コミュニティのエンジニアによって開発されたモジュール](https://exchange.stackstorm.org/) を利用) することで、定型化されたオペレーションを自動化することができます。これによって、システム管理者の運用コストを低減させることができます。  
　またユーザは、どういったシステムがどの管理者によってどれだけ存在しているかを知らなくても、一つの運用プラットフォーム (StackStorm) さえ認知していれば、そこから必要なワークフローを選択し、実行することができるようになります。ユーザにとっては、個別の運用についてワークフローの方法を探し回ったり、あるいは管理者に聞いたりといった手間がなくなるため、効率的に仕事を進めることができるようになります。また、システム管理者にとって、個別にユーザへの認知や精緻なユーザマニュアルの整備といった作業を簡略化できるため、より生産的な仕事に労力を割くことができるようになります。  

### Case2: サービスインフラの運用
　通常、何がしかのサービス環境を維持する場合、担当の運用者（ないしは運用チーム）がサービスを支えるシステムの状況を監視し、状況変化に応じてオペレーションを行います。  
　一般的に運用者がオペレーションを行う対象は、フルマネージドサービスでない場合、サービスを提供するシステムに加え、システムを支えるミドルウェア、アプライアンス、及びそれらを取り巻く管理・サポートシステム (タスク管理システムや構成管理システム) などが存在します。また、提供サービスの規模・機能が拡張されることで、運用者がオペレーションを行う対象は更に、多種・多様化することが予想されます。  

(挿絵) 多品種システムの運用が大変な図

　こうした環境においては、多種多様なシステムに精通した運用者を育成・採用しなければなりません。また提供サービスの規模・重要度に応じて運用の品質を高めるために、運用者を増やす必要が出てきます。  
　DMM.com ラボのインフラにおいても、多種多様な機器・システムを組織的に管理・運用しており、それぞれに対するオペレーションは、操作対象の機器・システムに精通した運用者によって行われています。  

　ただ、こうした運用者による個別具体的なオペレーションによるサービスの維持には、高いコストとリスクを伴います。  
　まず運用者は多種多様なシステムのオペレーションに精通しなければならず、これに対する学習（教育）のコストがかかります。また一人の運用者でカバーしきれないほどシステムが大規模・複雑化する場合には、それぞれのシステムに精通した運用者が組織的に対応しなければならず、これには大きな管理コストがかかります。更に、大規模・複雑なシステムを複数人の運用者（あるいはチーム）で運用する場合、メンテナンスや変更要求について、影響範囲の把握やユーザとの調整など、単純で小規模なシステム運用と比較して運用コストが増大します。  
　加えて、システムに対するオペレーションを実施する場合において、未熟な運用者によるオペレーションや、複雑なオペレーションを実施する場合には、オペレーションミスによる障害のリスクもあります。  

(挿絵) やんちゃなオペレータによる障害リスクの説明図

　StackStorm では、Case1 での述べたように個別のシステムへのオペレーションはソフトウェアによって行われる事に加え、StackStorm が [スケーラブルなアーキテクチャ](https://docs.stackstorm.com/reference/ha.html) になっていることで、サービスが大規模になった場合における運用コストを低減させることが期待できます。  
　また [コミュニティによってこれまでに開発されたモジュール](https://exchange.stackstorm.org/) の多くは機能的なテストを経て、多くのユーザによって利用されている実績を積んでおり、従来以上に安全なオペレーションを行えることが期待できます。  

### おわりに
　ここまで システムの運用にどのような課題認識を持ち、それらに対してどのように解決するかについて紹介してきました。  
　現在これらの課題解決に取り組んでいる最中のために、全てにおいて見込み通りの結果となるかは不確定な面もありますが、もし見込んだ成果が得られなかった際には、どのような要因が何に対してどのように作用したのかについて、また別の機会でご紹介できたらと思います。  
